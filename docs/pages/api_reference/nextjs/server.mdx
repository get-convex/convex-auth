# nextjs/server

## ConvexAuthNextjsServerProvider()


Wrap your app with this provider in your root `layout.tsx`.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`props`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`props.apiRoute`?

</td>
<td>

`string`

</td>
<td>

You can customize the route path that handles authentication
actions via this prop and the `apiRoute` option to `convexAuthNextjsMiddleWare`.

Defaults to `/api/auth`.

</td>
</tr>
<tr>
<td>

`props.storage`?

</td>
<td>

`"localStorage"` \| `"inMemory"`

</td>
<td>

Choose how the auth information will be stored on the client.

Defaults to `"localStorage"`.

If you choose `"inMemory"`, different browser tabs will not
have a synchronized authentication state.

</td>
</tr>
<tr>
<td>

`props.storageNamespace`?

</td>
<td>

`string`

</td>
<td>

Optional namespace for keys used to store tokens. The keys
determine whether the tokens are shared or not.

Any non-alphanumeric characters will be ignored.

Defaults to `process.env.NEXT_PUBLIC_CONVEX_URL`.

</td>
</tr>
<tr>
<td>

`props.verbose`?

</td>
<td>

`boolean`

</td>
<td>

Turn on debugging logs.

</td>
</tr>
<tr>
<td>

`props.children`

</td>
<td>

`ReactNode`

</td>
<td>

Children components can call Convex hooks
and [useAuthActions](/api_reference/react#useauthactions).

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Element`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:27](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L27)

***

## convexAuthNextjsToken()


Retrieve the token for authenticating calls to your
Convex backend from Server Components, Server Actions and Route Handlers.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`undefined` \| `string`

The token if the the client is authenticated, otherwise `undefined`.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:82](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L82)

***

## isAuthenticatedNextjs()


Whether the client is authenticated, which you can check
in Server Actions, Route Handlers and Middleware.

Avoid the pitfall of checking authentication state in layouts,
since they won't stop nested pages from rendering.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`boolean`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:93](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L93)

***

## ConvexAuthNextjsMiddlewareContext


In `convexAuthNextjsMiddleware`, you can use this context
to get the token and check if the client is authenticated in place of
`convexAuthNextjsToken` and `isAuthenticatedNextjs`.

```ts
export function convexAuthNextjsMiddleware(handler, options) {
  return async (request, event, convexAuth) => {
    if (!convexAuth.isAuthenticated()) {
      return nextjsMiddlewareRedirect(request, "/login");
    }
  };
}
```

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### getToken()


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`string` \| `undefined`

#### isAuthenticated()


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`boolean`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:112](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L112)

***

## convexAuthNextjsMiddleware()


Use in your `middleware.ts` to enable your Next.js app to use
Convex Auth for authentication on the server.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`handler`?

</td>
<td>

(`request`, `ctx`) => `NextMiddlewareResult` \| `Promise`\<`NextMiddlewareResult`\>

</td>
<td>

A custom handler, which you can use to decide
which routes should be accessible based on the client's authentication.

</td>
</tr>
<tr>
<td>

`options`?

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`options.convexUrl`?

</td>
<td>

`string`

</td>
<td>

The URL of the Convex deployment to use for authentication.

Defaults to `process.env.NEXT_PUBLIC_CONVEX_URL`.

</td>
</tr>
<tr>
<td>

`options.apiRoute`?

</td>
<td>

`string`

</td>
<td>

You can customize the route path that handles authentication
actions via this option and the `apiRoute` prop of `ConvexAuthNextjsProvider`.

Defaults to `/api/auth`.

</td>
</tr>
<tr>
<td>

`options.verbose`?

</td>
<td>

`boolean`

</td>
<td>

Turn on debugging logs.

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`NextMiddleware`

A Next.js middleware.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:123](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L123)

***

## nextjsMiddlewareRedirect()


Helper for redirecting to a different route from
a Next.js middleware.

```ts
return nextjsMiddlewareRedirect(request, "/login");
```

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`request`

</td>
<td>

`NextRequest`

</td>
<td>

The incoming request handled by the middleware.

</td>
</tr>
<tr>
<td>

`pathname`

</td>
<td>

`string`

</td>
<td>

The route path to redirect to.

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`NextResponse`\<`unknown`\>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/index.tsx:244](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/index.tsx#L244)

***

## RouteMatcherParam


See [createRouteMatcher](server.mdx#createroutematcher) for more information.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/routeMatcher.ts:44](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/routeMatcher.ts#L44)

***

## createRouteMatcher()


Returns a function that accepts a `Request` object and returns whether the request matches the list of
predefined routes that can be passed in as the first argument.

You can use glob patterns to match multiple routes or a function to match against the request object.
Path patterns are supported, for example: `['/foo', '/bar{/*extra}'].

Note: regular expressions are not supported in path patterns.

For more information, see: https://github.com/pillarjs/path-to-regexp

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`routes`

</td>
<td>

[`RouteMatcherParam`](server.mdx#routematcherparam)

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Function`

<h4 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h4>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`req`

</td>
<td>

`NextRequest`

</td>
</tr>
</tbody></table>

<h4 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h4>

`boolean`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/nextjs/server/routeMatcher.ts:61](https://github.com/get-convex/convex-auth/blob/main/src/nextjs/server/routeMatcher.ts#L61)
