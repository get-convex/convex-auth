# server

Configuration and helpers for using Convex Auth on your Convex
backend.

Call [convexAuth](server.mdx#convexauth) to configure your authentication methods
and use the helpers it returns.

Include [authTables](server.mdx#authtables) in your schema.

## SignInAction


The type of the signIn Convex Action returned from the auth() helper.

This type is exported for implementors of other client integrations.
However it is not stable, and may change until this library reaches 1.0.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:65](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L65)

***

## SignOutAction


The type of the signOut Convex Action returned from the auth() helper.

This type is exported for implementors of other client integrations.
However it is not stable, and may change until this library reaches 1.0.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:74](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L74)

***

## IsAuthenticatedQuery


The type of the isAuthenticated Convex Query returned from the auth() helper.

This type is exported for implementors of other client integrations.
However it is not stable, and may change until this library reaches 1.0.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:83](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L83)

***

## convexAuth()


Configure the Convex Auth library. Returns an object with
functions and `auth` helper. You must export the functions
from `convex/auth.ts` to make them callable:

```ts filename="convex/auth.ts"
import { convexAuth } from "@convex-dev/auth/server";

export const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({
  providers: [],
});
```

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`config_`

</td>
<td>

[`ConvexAuthConfig`](server.mdx#convexauthconfig)

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`object`

An object with fields you should reexport from your
         `convex/auth.ts` file.

#### auth


Helper for configuring HTTP actions.

#### auth.addHttpRoutes()


Add HTTP actions for JWT verification and OAuth sign-in.

```ts
import { httpRouter } from "convex/server";
import { auth } from "./auth.js";

const http = httpRouter();

auth.addHttpRoutes(http);

export default http;
```

The following routes are handled always:

- `/.well-known/openid-configuration`
- `/.well-known/jwks.json`

The following routes are handled if OAuth is configured:

- `/api/auth/signin/*`
- `/api/auth/callback/*`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`http`

</td>
<td>

`HttpRouter`

</td>
<td>

your HTTP router

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`void`

#### signIn


Action called by the client to sign the user in.

Also used for refreshing the session.

#### signOut


Action called by the client to invalidate the current session.

#### store


Internal mutation used by the library to read and write
to the database during signin and signout.

#### isAuthenticated


Utility function for frameworks to use to get the current auth state
based on credentials that they've supplied separately.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:103](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L103)

***

## getAuthUserId()


Return the currently signed-in user's ID.

```ts filename="convex/myFunctions.tsx"
import { mutation } from "./_generated/server";
import { getAuthUserId } from "@convex-dev/auth/server";

export const doSomething = mutation({
  args: {/* ... */},
  handler: async (ctx, args) => {
    const userId = await getAuthUserId(ctx);
    if (userId === null) {
      throw new Error("Client is not authenticated!")
    }
    const user = await ctx.db.get(userId);
    // ...
  },
});
```

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`object`

</td>
<td>

query, mutation or action `ctx`

</td>
</tr>
<tr>
<td>

`ctx.auth`

</td>
<td>

`Auth`

</td>
<td>

&hyphen;

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`null` \| `Id`\<`"users"`\>\>

the user ID or `null` if the client isn't authenticated

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:493](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L493)

***

## createAccount()


Use this function from a
[`ConvexCredentials`](/api_reference/providers/ConvexCredentials)
provider to create an account and a user with a unique account "id" (OAuth
provider ID, email address, phone number, username etc.).

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericActionCtx`\<`DataModel`\>

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.provider`

</td>
<td>

`string`

</td>
<td>

The provider ID (like "password"), used to disambiguate accounts.

It is also used to configure account secret hashing via the provider's
`crypto` option.

</td>
</tr>
<tr>
<td>

`args.account`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.account.id`

</td>
<td>

`string`

</td>
<td>

The unique external ID for the account, for example email address.

</td>
</tr>
<tr>
<td>

`args.account.secret`?

</td>
<td>

`string`

</td>
<td>

The secret credential to store for this account, if given.

</td>
</tr>
<tr>
<td>

`args.profile`

</td>
<td>

`WithoutSystemFields`\<`DocumentByName`\<`DataModel`, `"users"`\>\>

</td>
<td>

The profile data to store for the user.
These must fit the `users` table schema.

</td>
</tr>
<tr>
<td>

`args.shouldLinkViaEmail`?

</td>
<td>

`boolean`

</td>
<td>

If `true`, the account will be linked to an existing user
with the same verified email address.
This is only safe if the returned account's email is verified
before the user is allowed to sign in with it.

</td>
</tr>
<tr>
<td>

`args.shouldLinkViaPhone`?

</td>
<td>

`boolean`

</td>
<td>

If `true`, the account will be linked to an existing user
with the same verified phone number.
This is only safe if the returned account's phone is verified
before the user is allowed to sign in with it.

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`object`\>

user ID if it successfully creates the account
or throws an error.

#### account


#### user


<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:511](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L511)

***

## retrieveAccount()


Use this function from a
[`ConvexCredentials`](/api_reference/providers/ConvexCredentials)
provider to retrieve a user given the account provider ID and
the provider-specific account ID.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericActionCtx`\<`DataModel`\>

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.provider`

</td>
<td>

`string`

</td>
<td>

The provider ID (like "password"), used to disambiguate accounts.

It is also used to configure account secret hashing via the provider's
`crypto` option.

</td>
</tr>
<tr>
<td>

`args.account`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.account.id`

</td>
<td>

`string`

</td>
<td>

The unique external ID for the account, for example email address.

</td>
</tr>
<tr>
<td>

`args.account.secret`?

</td>
<td>

`string`

</td>
<td>

The secret that should match the stored credential, if given.

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`object`\>

the retrieved user document, or `null` if there is no account
for given account ID or throws if the provided
secret does not match.

#### account


#### user


<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:571](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L571)

***

## modifyAccountCredentials()


Use this function to modify the account credentials
from a [`ConvexCredentials`](/api_reference/providers/ConvexCredentials)
provider.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericActionCtx`\<`DataModel`\>

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.provider`

</td>
<td>

`string`

</td>
<td>

The provider ID (like "password"), used to disambiguate accounts.

It is also used to configure account secret hashing via the `crypto` option.

</td>
</tr>
<tr>
<td>

`args.account`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.account.id`

</td>
<td>

`string`

</td>
<td>

The unique external ID for the account, for example email address.

</td>
</tr>
<tr>
<td>

`args.account.secret`

</td>
<td>

`string`

</td>
<td>

The new secret credential to store for this account.

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`void`\>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:611](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L611)

***

## invalidateSessions()


Use this function to invalidate existing sessions.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericActionCtx`\<`DataModel`\>

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
</tr>
<tr>
<td>

`args.userId`

</td>
<td>

`Id`\<`"users"`\>

</td>
</tr>
<tr>
<td>

`args.except`?

</td>
<td>

`Id`\<`"authSessions"`\>[]

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`void`\>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:641](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L641)

***

## signInViaProvider()


Use this function from a
[`ConvexCredentials`](/api_reference/providers/ConvexCredentials)
provider to sign in the user via another provider (usually
for email verification on sign up or password reset).

Returns the user ID if the sign can proceed,
or `null`.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

[`GenericActionCtxWithAuthConfig`](server.mdx#genericactionctxwithauthconfigdatamodel)\<`DataModel`\>

</td>
</tr>
<tr>
<td>

`provider`

</td>
<td>

[`AuthProviderConfig`](server.mdx#authproviderconfig)

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
</tr>
<tr>
<td>

`args.accountId`?

</td>
<td>

`Id`\<`"authAccounts"`\>

</td>
</tr>
<tr>
<td>

`args.params`?

</td>
<td>

`Record`\<`string`, `undefined` \| `Value`\>

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`null` \| `object`\>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/index.ts:663](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/index.ts#L663)

***

## getAuthSessionId()


Return the current session ID.

```ts filename="convex/myFunctions.tsx"
import { mutation } from "./_generated/server";
import { getAuthSessionId } from "@convex-dev/auth/server";

export const doSomething = mutation({
  args: {/* ... */},
  handler: async (ctx, args) => {
    const sessionId = await getAuthSessionId(ctx);
    if (sessionId === null) {
      throw new Error("Client is not authenticated!")
    }
    const session = await ctx.db.get(sessionId);
    // ...
  },
});
```

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Parameters</h3>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`object`

</td>
<td>

query, mutation or action `ctx`

</td>
</tr>
<tr>
<td>

`ctx.auth`

</td>
<td>

`Auth`

</td>
<td>

&hyphen;

</td>
</tr>
</tbody></table>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Returns</h3>

`Promise`\<`null` \| `Id`\<`"authSessions"`\>\>

the session ID or `null` if the client isn't authenticated

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/sessions.ts:131](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/sessions.ts#L131)

***

## authTables


The table definitions required by the library.

Your schema must include these so that the indexes
are set up:

```ts filename="convex/schema.ts"
import { defineSchema } from "convex/server";
import { authTables } from "@convex-dev/auth/server";

const schema = defineSchema({
  ...authTables,
});

export default schema;
```

You can inline the table definitions into your schema
and extend them with additional optional and required
fields. See /setup/schema
for more details.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### users


Users.

#### authSessions


Sessions.
A single user can have multiple active sessions.
See [Session document lifecycle](/advanced#session-document-lifecycle).

#### authAccounts


Accounts. An account corresponds to
a single authentication provider.
A single user can have multiple accounts linked.

#### authRefreshTokens


Refresh tokens.
Refresh tokens are generally meant to be used once, to be exchanged for another
refresh token and a JWT access token, but with a few exceptions:
- The "active refresh token" is the most recently created refresh token that has
  not been used yet. The parent of the active refresh token can always be used to
  obtain the active refresh token.
- A refresh token can be used within a 10 second window ("reuse window") to
  obtain a new refresh token.
- On any invalid use of a refresh token, the token itself and all its descendants
  are invalidated.

#### authVerificationCodes


Verification codes:
- OTP tokens
- magic link tokens
- OAuth codes

#### authVerifiers


PKCE verifiers for OAuth.

#### authRateLimits


Rate limits for OTP and password sign-in.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/types.ts:36](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/types.ts#L36)

***

## Doc\<T\>


<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/types.ts:140](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/types.ts#L140)

***

## Tokens


<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### token

> **token**: `string`

#### refreshToken

> **refreshToken**: `string`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/implementation/types.ts:145](https://github.com/get-convex/convex-auth/blob/main/src/server/implementation/types.ts#L145)

***

## ConvexAuthConfig


The config for the Convex Auth library, passed to `convexAuth`.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### providers


A list of authentication provider configs.

You can import existing configs from
- `@auth/core/providers/<provider-name>`
- `@convex-dev/auth/providers/<provider-name>`

#### theme?

> `optional` **theme**: `Theme`

Theme used for emails.
See [Auth.js theme docs](https://authjs.dev/reference/core/types#theme).

#### session?


Session configuration.

#### session.totalDurationMs?

> `optional` **totalDurationMs**: `number`

How long can a user session last without the user reauthenticating.

Defaults to 30 days.

#### session.inactiveDurationMs?

> `optional` **inactiveDurationMs**: `number`

How long can a user session last without the user being active.

Defaults to 30 days.

#### jwt?


JWT configuration.

#### jwt.durationMs?

> `optional` **durationMs**: `number`

How long is the JWT valid for after it is signed initially.

Defaults to 1 hour.

#### signIn?


Sign-in configuration.

#### signIn.maxFailedAttempsPerHour?

> `optional` **maxFailedAttempsPerHour**: `number`

How many times can the user fail to provide the correct credentials
(password, OTP) per hour.

Defaults to 10 times per hour (that is 10 failed attempts, and then
allow another one every 6 minutes).

#### callbacks?


#### callbacks.redirect()?


Control which URLs are allowed as a destination after OAuth sign-in
and for magic links:

```ts
import GitHub from "@auth/core/providers/github";
import { convexAuth } from "@convex-dev/auth/server";

export const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({
  providers: [GitHub],
  callbacks: {
    async redirect({ redirectTo }) {
      // Check that `redirectTo` is valid
      // and return the relative or absolute URL
      // to redirect to.
    },
  },
});
```

Convex Auth performs redirect only during OAuth sign-in. By default,
it redirects back to the URL specified via the `SITE_URL` environment
variable. Similarly magic links link to `SITE_URL`.

You can customize that behavior by providing a `redirectTo` param
to the `signIn` function:

```ts
signIn("google", { redirectTo: "/dashboard" })
```

You can even redirect to a different site.

This callback, if specified, is then called with the provided
`redirectTo` param. Otherwise, only query params, relative paths
and URLs starting with `SITE_URL` are allowed.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`params`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`params.redirectTo`

</td>
<td>

`string`

</td>
<td>

The param value passed to the `signIn` function.

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`string`\>

#### callbacks.createOrUpdateUser()?


Completely control account linking via this callback.

This callback is called during the sign-in process,
before account creation and token generation.
If specified, this callback is responsible for creating
or updating the user document.

For "credentials" providers, the callback is only called
when `createAccount` is called.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericMutationCtx`\<`AnyDataModel`\>

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.existingUserId`

</td>
<td>

`GenericId`\<`"users"`\> \| `null`

</td>
<td>

If this is a sign-in to an existing account,
this is the existing user ID linked to that account.

</td>
</tr>
<tr>
<td>

`args.type`

</td>
<td>

`"oauth"` \| `"credentials"` \| `"email"` \| `"phone"` \| `"verification"`

</td>
<td>

The provider type or "verification" if this callback is called
after an email or phone token verification.

</td>
</tr>
<tr>
<td>

`args.provider`

</td>
<td>

[`AuthProviderMaterializedConfig`](server.mdx#authprovidermaterializedconfig)

</td>
<td>

The provider used for the sign-in, or the provider
tied to the account which is having the email or phone verified.

</td>
</tr>
<tr>
<td>

`args.profile`

</td>
<td>

`Record`\<`string`, `unknown`\> & `object`

</td>
<td>

- The profile returned by the OAuth provider's `profile` method.
- The profile passed to `createAccount` from a ConvexCredentials
config.
- The email address to which an email will be sent.
- The phone number to which a text will be sent.

</td>
</tr>
<tr>
<td>

`args.shouldLink`?

</td>
<td>

`boolean`

</td>
<td>

The `shouldLink` argument passed to `createAccount`.

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`GenericId`\<`"users"`\>\>

#### callbacks.afterUserCreatedOrUpdated()?


Perform additional writes after a user is created.

This callback is called during the sign-in process,
after the user is created or updated,
before account creation and token generation.

**This callback is only called if `createOrUpdateUser`
is not specified.** If `createOrUpdateUser` is specified,
you can perform any additional writes in that callback.

For "credentials" providers, the callback is only called
when `createAccount` is called.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

`GenericMutationCtx`\<`AnyDataModel`\>

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args`

</td>
<td>

`object`

</td>
<td>

&hyphen;

</td>
</tr>
<tr>
<td>

`args.userId`

</td>
<td>

`GenericId`\<`"users"`\>

</td>
<td>

The ID of the user that is being signed in.

</td>
</tr>
<tr>
<td>

`args.existingUserId`

</td>
<td>

`GenericId`\<`"users"`\> \| `null`

</td>
<td>

If this is a sign-in to an existing account,
this is the existing user ID linked to that account.

</td>
</tr>
<tr>
<td>

`args.type`

</td>
<td>

`"oauth"` \| `"credentials"` \| `"email"` \| `"phone"` \| `"verification"`

</td>
<td>

The provider type or "verification" if this callback is called
after an email or phone token verification.

</td>
</tr>
<tr>
<td>

`args.provider`

</td>
<td>

[`AuthProviderMaterializedConfig`](server.mdx#authprovidermaterializedconfig)

</td>
<td>

The provider used for the sign-in, or the provider
tied to the account which is having the email or phone verified.

</td>
</tr>
<tr>
<td>

`args.profile`

</td>
<td>

`Record`\<`string`, `unknown`\> & `object`

</td>
<td>

- The profile returned by the OAuth provider's `profile` method.
- The profile passed to `createAccount` from a ConvexCredentials
config.
- The email address to which an email will be sent.
- The phone number to which a text will be sent.

</td>
</tr>
<tr>
<td>

`args.shouldLink`?

</td>
<td>

`boolean`

</td>
<td>

The `shouldLink` argument passed to `createAccount`.

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`void`\>

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:22](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L22)

***

## AuthProviderConfig


Same as Auth.js provider configs, but adds phone provider
for verification via SMS or another phone-number-connected messaging
service.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:232](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L232)

***

## EmailConfig\<DataModel\>

Extends the standard Auth.js email provider config
to allow additional checks during token verification.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Extends</h3>

- `EmailConfig`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Properties</h3>

#### id

> **id**: `string`

Uniquely identifies the provider in AuthConfig.providers
It's also part of the URL

##### Inherited from

`AuthjsEmailConfig.id`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:14](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L14)

#### type


See ProviderType

##### Inherited from

`AuthjsEmailConfig.type`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:15](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L15)

#### name

> **name**: `string`

The provider name used on the default sign-in page's sign-in button.
For example if it's "Google", the corresponding button will say:
"Sign in with Google"

##### Inherited from

`AuthjsEmailConfig.name`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:16](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L16)

#### from?

> `optional` **from**: `string`

##### Inherited from

`AuthjsEmailConfig.from`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:17](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L17)

#### maxAge?

> `optional` **maxAge**: `number`

##### Inherited from

`AuthjsEmailConfig.maxAge`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:18](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L18)

#### sendVerificationRequest()


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`params`

</td>
<td>

`object`

</td>
</tr>
<tr>
<td>

`params.identifier`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`params.url`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`params.expires`

</td>
<td>

`Date`

</td>
</tr>
<tr>
<td>

`params.provider`

</td>
<td>

`EmailConfig`

</td>
</tr>
<tr>
<td>

`params.token`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`params.theme`

</td>
<td>

`Theme`

</td>
</tr>
<tr>
<td>

`params.request`

</td>
<td>

`Request`

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Awaitable`\<`void`\>

##### Inherited from

`AuthjsEmailConfig.sendVerificationRequest`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:19](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L19)

#### secret?

> `optional` **secret**: `string`

Used to hash the verification token.

##### Inherited from

`AuthjsEmailConfig.secret`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:29](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L29)

#### apiKey?

> `optional` **apiKey**: `string`

Used with HTTP-based email providers.

##### Inherited from

`AuthjsEmailConfig.apiKey`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:31](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L31)

#### server?

> `optional` **server**: `any`

Used with SMTP-based email providers.

##### Inherited from

`AuthjsEmailConfig.server`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:33](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L33)

#### generateVerificationToken()?


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Awaitable`\<`string`\>

##### Inherited from

`AuthjsEmailConfig.generateVerificationToken`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:34](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L34)

#### normalizeIdentifier()?


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`identifier`

</td>
<td>

`string`

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`string`

##### Inherited from

`AuthjsEmailConfig.normalizeIdentifier`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:35](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L35)

#### options?

> `optional` **options**: `EmailUserConfig`

##### Inherited from

`AuthjsEmailConfig.options`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[node\_modules/@auth/core/providers/email.d.ts:36](https://github.com/get-convex/convex-auth/blob/main/node_modules/@auth/core/providers/email.d.ts#L36)

#### authorize()?


Before the token is verified, check other
provided parameters.

Used to make sure tha OTPs are accompanied
with the correct email address.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`params`

</td>
<td>

`Record`\<`string`, `undefined` \| `Value`\>

</td>
<td>

The values passed to the `signIn` function.

</td>
</tr>
<tr>
<td>

`account`

</td>
<td>

[`GenericDoc`](server.mdx#genericdocdatamodel-tablename)\<`DataModel`, `"authAccounts"`\>

</td>
<td>

&hyphen;

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`void`\>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:256](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L256)

***

## EmailUserConfig\<DataModel\>


Configurable options for an email provider config.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:268](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L268)

***

## PhoneConfig\<DataModel\>

Same as email provider config, but verifies
phone number instead of the email address.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Properties</h3>

#### id

> **id**: `string`

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:279](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L279)

#### type


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:280](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L280)

#### maxAge

> **maxAge**: `number`

Token expiration in seconds.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:284](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L284)

#### sendVerificationRequest()


Send the phone number verification request.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
<tr>
<td>

`params`

</td>
<td>

`object`

</td>
</tr>
<tr>
<td>

`params.identifier`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`params.url`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`params.expires`

</td>
<td>

`Date`

</td>
</tr>
<tr>
<td>

`params.provider`

</td>
<td>

[`PhoneConfig`](server.mdx#phoneconfigdatamodel)\<`GenericDataModel`\>

</td>
</tr>
<tr>
<td>

`params.token`

</td>
<td>

`string`

</td>
</tr>
<tr>
<td>

`ctx`

</td>
<td>

[`GenericActionCtxWithAuthConfig`](server.mdx#genericactionctxwithauthconfigdatamodel)\<`DataModel`\>

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`void`\>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:288](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L288)

#### apiKey?

> `optional` **apiKey**: `string`

Defaults to `process.env.AUTH_<PROVIDER_ID>_KEY`.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:301](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L301)

#### generateVerificationToken()?


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`string`\>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:310](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L310)

#### normalizeIdentifier()?


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`identifier`

</td>
<td>

`string`

</td>
<td>

Passed as `phone` in params of `signIn`.

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`string`

The phone number used in `sendVerificationRequest`.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:316](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L316)

#### authorize()?


Before the token is verified, check other
provided parameters.

Used to make sure tha OTPs are accompanied
with the correct phone number.

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Parameters</h5>

<table className="api_reference_table"><tbody>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr>
<td>

`params`

</td>
<td>

`Record`\<`string`, `undefined` \| `Value`\>

</td>
<td>

The values passed to the `signIn` function.

</td>
</tr>
<tr>
<td>

`account`

</td>
<td>

[`GenericDoc`](server.mdx#genericdocdatamodel-tablename)\<`DataModel`, `"authAccounts"`\>

</td>
<td>

&hyphen;

</td>
</tr>
</tbody></table>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Returns</h5>

`Promise`\<`void`\>

<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:324](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L324)

#### options


<h5 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-lg">Defined in</h5>

[src/server/types.ts:331](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L331)

***

## PhoneUserConfig\<DataModel\>


Configurable options for a phone provider config.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:337](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L337)

***

## ConvexCredentialsConfig


Similar to Auth.js Credentials config.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### type


#### id

> **id**: `string`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:344](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L344)

***

## GenericActionCtxWithAuthConfig\<DataModel\>


Your `ActionCtx` enriched with `ctx.auth.config` field with
the config passed to `convexAuth`.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### auth


#### auth.config


<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:353](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L353)

***

## ConvexAuthMaterializedConfig


The config for the Convex Auth library, passed to `convexAuth`,
with defaults and initialized providers.

See [ConvexAuthConfig](server.mdx#convexauthconfig)

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Type declaration</h3>

#### providers


#### theme

> **theme**: `Theme`

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:364](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L364)

***

## AuthProviderMaterializedConfig


Materialized Auth.js provider config.

<h3 className="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defined in</h3>

[src/server/types.ts:372](https://github.com/get-convex/convex-auth/blob/main/src/server/types.ts#L372)
