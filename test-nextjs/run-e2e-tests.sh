#!/bin/bash
set -e
# Extra layer of escaping because these args are parsed twice
just convex env set JWT_PRIVATE_KEY -- '"-----BEGIN PRIVATE KEY----- MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDxgLGw9Mgsb0R+ 63hiQW81pHVIcatTws6PCIEvnH/fG6JBtZrQLxfXt3UynHE9oBqhDCKyf/q4QA9S DJMTmtSqHttIAYgPhKNBLe07l3drK/JvTDGYbgV23qVhPlwD4MuQJROCPGGv8Ch3 ce+JUmR6mFAbUH0Id9S38IqpP2VxxnFLqM0YqEuzeoZ7qHkAIOInDSTj4+k4vlrF sZ5iLINhhxuS3DCTOhvud3mvQ7jzRvB7xvciClU0m5kG9esqGPI08FZwaa7qy+Bt F7jgj5Dy4KMnIETSxpRqAeI7yuXPNBSpjWgeNcuX8aqZyhXiallRs+ZF4BVyQBVc 2wLPZlx/AgMBAAECggEAdVKOAGeKb3vGjNob66/aNPcmOwFtuA1lh7sb92NSA7NL Ch0NjqGyNYvcla/Gm6eSCDb7DDh8NtJ4HuYY9Wc8dUD0SnDkBpXrMZj8LP0SeLAq 4MLlPSYF5Y+YTDudPA0TF33LknN/CZfkMNLbCZ1LTvt7vylE9L4ySwHCeyJfR/us KFKj/64BIwfjl1kJcMJi4rQF/ZL1LGrO0E75UzLyhoQ7WtVjU9S7sFV+7lucOcZG PG8ffanXTa5BbhSr/QI2JUDBigAaNa9fAFn7o4smUUUjK3AdbrlHu3DCWZExJmOt SFeJmsMi/gXyoa60L8hSZRpP2VXTrCFJAUYz9K8Q4QKBgQD7T5YXTsujBVV6pr9M tYpuwv5KLI/uMrOU/23I0jmLRSuigWcsLKnq1wffCzvj419k4xCugT6je5BO92WU QAFa/UXsyEk4LfrfnlSMyWhP4kHYPPJ1W7oIZrH4r92yI+pylINb8T/yPANXvgUK 3gzdX4xZTiq1pUcaf9SxJH4s2QKBgQD2AkING6bog9/gBBaxcnR1Hm8tKzP9FkjS IdFzORt24oXAgmQQ6xLXTOnHzGw5TXGrIGFHKItUIgLSUN6fjoXiQfNV5xai6je1 qVVBf6TeAAM3r0+GsJ1fWVweqS6t+LqjzYCl/e6twMk39Q4V+wzJRRzhiud96+fP 23Bh0oHdFwKBgQCHD1WVfyZXnWU7/mNvAV29exQYnuxXUm5K1B+XPsvoOitiMXNW PUawTBIR38K3DZpV6OYtMo6MY7rBhZnU27UexmEPCPC4vZVHGptL8m4aCHnkkZSo V7yaCT76bOGTfFPickhKYFRChdgyDpA9L+rwCgqucCDp8EJPToXrEbaxuQKBgQDC c4J2DfdeLm7VCSZO2GNI9+d00oNjdyvUPLrr0qXs0JxcUDR8UvMvjzHypZidqqNA WnXJ4zhOJhwI1bdCc0tMTkjjC6gO2gdy5gfnn9dXSrdAWqgHlK6v4Vg5PA0TolkU hKk9i3wPhyUFwAOESE4RAToU5NCZ7c/rsk4gZF4VvQKBgQCBBxZTKCymPCiFqPkb sLOtZDEPIOud9Ql8dc/z2rkwhjsERRiGy6b3YR7O+PVRXIJq6nu6hygBr10Imo7G jfFQsT3NlNEwvmu7INDDuhW0UhVjal9OlPuf7VZGGDLMNomyeRdBH4yxzziZsDzl q4CPk75t3by5e9jr9DaU7ZAk2w== -----END PRIVATE KEY-----"'
just convex env set JWKS='"{\"keys\":[{\"use\":\"sig\",\"kty\":\"RSA\",\"n\":\"8YCxsPTILG9Efut4YkFvNaR1SHGrU8LOjwiBL5x_3xuiQbWa0C8X17d1MpxxPaAaoQwisn_6uEAPUgyTE5rUqh7bSAGID4SjQS3tO5d3ayvyb0wxmG4Fdt6lYT5cA-DLkCUTgjxhr_Aod3HviVJkephQG1B9CHfUt_CKqT9lccZxS6jNGKhLs3qGe6h5ACDiJw0k4-PpOL5axbGeYiyDYYcbktwwkzob7nd5r0O480bwe8b3IgpVNJuZBvXrKhjyNPBWcGmu6svgbRe44I-Q8uCjJyBE0saUagHiO8rlzzQUqY1oHjXLl_GqmcoV4mpZUbPmReAVckAVXNsCz2Zcfw\",\"e\":\"AQAB\"}]}"'
just convex env set AUTH_E2E_TEST_SECRET foobarbaz
just convex env set IS_TEST true
just convex deploy
just convex run tests:init
npx playwright test
